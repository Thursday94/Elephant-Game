<!doctype html>
<html lang="pl">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <title>Elephant Coffee ‚Äî Gra</title>
    <style>
        :root {
            --brand: #ffd7b3;
            --gold: #ffd700;
            --text: #fff;
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        html,
        body {
            height: 100%;
            margin: 0;
            background: #000;
            color: var(--text);
            font-family: Inter, system-ui, sans-serif;
        }

        body {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .app {
            position: relative;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            background: #0f0f0f;
            box-shadow: 0 0 45px rgba(0, 0, 0, .65) inset, 0 0 45px rgba(255, 215, 179, .18);
        }

        .app.slowmo::before {
            content: "";
            position: absolute;
            inset: 0;
            pointer-events: none;
            background: radial-gradient(circle, rgba(255, 205, 150, .18), rgba(0, 0, 0, 0) 70%);
            animation: slowPulse 1s ease-in-out infinite;
            z-index: 8;
        }

        @keyframes slowPulse {
            0% {
                opacity: .15
            }

            50% {
                opacity: .45
            }

            100% {
                opacity: .15
            }
        }

.safe {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  padding: 14px;
  padding-top: calc(env(safe-area-inset-top) + 14px);
  display: flex;
  justify-content: space-between;
  z-index: 5;
  font-weight: 700;
  color: #fff;
  letter-spacing: 0.5px;
}

.pill {
  background: rgba(255, 215, 179, 0.18);
  border: 1px solid rgba(255, 215, 179, 0.45);
  border-radius: 999px;
  padding: 10px 20px;                /* –±–æ–ª—å—à–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –æ—Ç—Å—Ç—É–ø */
  font-size: 1.1rem;                 /* –∫—Ä—É–ø–Ω–µ–µ —à—Ä–∏—Ñ—Ç */
  color: #ffd7b3;
  font-weight: 600;
  box-shadow:
    0 0 14px rgba(255, 215, 179, 0.12),
    inset 0 0 12px rgba(255, 215, 179, 0.07);
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  transition: all 0.25s ease;
}

.pill:hover {
  background: rgba(255, 215, 179, 0.28);
  box-shadow:
    0 0 16px rgba(255, 215, 179, 0.3),
    inset 0 0 10px rgba(255, 215, 179, 0.2);
  transform: scale(1.05);
}


.sheet {
  animation: slideUp 0.45s cubic-bezier(0.25, 1, 0.5, 1) forwards;
  box-shadow:
    0 -6px 25px rgba(0, 0, 0, 0.6),
    0 -2px 12px rgba(255, 215, 179, 0.25);
  border-radius: 16px;
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  background: rgba(0, 0, 0, 0.7);
  position: absolute;
  z-index: 10;
}
@keyframes slideUp {
  0% {
    transform: translateY(60px) scale(0.97);
    opacity: 0;
  }
  60% {
    transform: translateY(-4px) scale(1.02);
    opacity: 1;
  }
  100% {
    transform: translateY(0) scale(1);
  }
}


        /* ‚ö° –≠–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–∞—è –≤—Å–ø—ã—à–∫–∞ */
        .lightning-burst {
            position: absolute;
            width: 120px;
            height: 120px;
            pointer-events: none;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255, 255, 255, .9) 0%, rgba(255, 255, 0, .45) 30%, rgba(255, 150, 0, .3) 50%, rgba(0, 0, 0, 0) 70%);
            transform: translate(-50%, -50%) scale(.3);
            opacity: .95;
            filter: drop-shadow(0 0 30px rgba(255, 255, 0, .7)) drop-shadow(0 0 50px rgba(255, 170, 0, .65));
            animation: lightningExpand .35s ease-out forwards;
        }

        @keyframes lightningExpand {
            0% {
                transform: translate(-50%, -50%) scale(.3) rotate(0deg);
                opacity: .95;
                filter: drop-shadow(0 0 20px rgba(255, 255, 0, .6));
            }

            50% {
                transform: translate(-50%, -50%) scale(1.4) rotate(20deg);
                opacity: 1;
                filter: drop-shadow(0 0 60px rgba(255, 255, 0, 1));
            }

            100% {
                transform: translate(-50%, -50%) scale(2) rotate(40deg);
                opacity: 0;
            }
        }

        .lightning-ray {
            position: absolute;
            width: 4px;
            height: 34px;
            background: linear-gradient(to bottom, #fff, rgba(255, 255, 255, 0));
            border-radius: 4px;
            pointer-events: none;
            opacity: .9;
            transform-origin: center bottom;
            animation: lightningRay .35s ease-out forwards;
            filter: drop-shadow(0 0 10px rgba(255, 255, 255, .8));
        }

        @keyframes lightningRay {
            100% {
                transform: translate(var(--dx), var(--dy)) rotate(var(--rot)) scaleY(1.4);
                opacity: 0;
            }
        }

        .logo,
        .super,
        .bomb,
        .big,
        .tornado {
            position: absolute;
            top: -80px;
            width: 60px;
            height: 60px;
            object-fit: contain;
            cursor: pointer;
            user-select: none;
            touch-action: manipulation;
            will-change: transform, left, top;
            filter: brightness(1.12) contrast(1.06) drop-shadow(0 10px 14px rgba(0, 0, 0, .65));
            transition: filter .18s ease, transform .18s ease;
        }

        .click-bounce:active {
            transform: scale(.88) rotate(-2deg);
        }

        .super {
            border-radius: 50%;
            box-shadow: 0 0 0 3px var(--gold), 0 0 14px var(--gold), 0 0 22px rgba(255, 215, 0, .35);
        }

        .super {
            animation: fall var(--fallDur) linear forwards, tilt 2.2s infinite, glowEnter .35s ease-out;
        }

        @keyframes glowEnter {
            from {
                transform: scale(1.2);
                filter: brightness(1.4)
            }

            to {
                transform: scale(1)
            }
        }

        .big {
            filter: drop-shadow(0 10px 18px rgba(0, 0, 0, .55)) drop-shadow(0 0 14px rgba(255, 215, 179, .25));
            width: 180px;
            height: 180px;
        }

        .logo {
            filter: drop-shadow(0 6px 10px rgba(0, 0, 0, .45)) drop-shadow(0 0 6px rgba(255, 215, 179, .45));
        }

        .logo:active {
            filter: brightness(1.4) drop-shadow(0 0 12px rgba(255, 215, 179, .75)) drop-shadow(0 0 22px rgba(255, 170, 90, .45));
            transform: scale(.94);
            transition: transform .05s;
        }

        .app.slowmo .logo,
        .app.slowmo .super,
        .app.slowmo .big,
        .app.slowmo .bomb,
        .app.slowmo .tornado,
        .app.slowmo .roma {
            animation-duration: calc(var(--fallDur) * 2.8), 2.2s !important;
            filter: drop-shadow(0 0 18px rgba(255, 200, 140, .5));
        }

        .overlay {
            backdrop-filter: blur(2px);
        }

        .bomb {
            font-size: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            filter: drop-shadow(0 12px 16px rgba(0, 0, 0, .75));
        }

        @keyframes fall {
            to {
                transform: translateY(calc(100vh + 140px)) rotate(var(--rot, 0deg));
            }
        }

        @keyframes tilt {
            0% {
                transform: rotate(-6deg)
            }

            50% {
                transform: rotate(6deg)
            }

            100% {
                transform: rotate(-6deg)
            }
        }

        .logo,
        .super {
            animation-name: fall, tilt;
            animation-duration: var(--fallDur, 2000ms), 2.2s;
            animation-timing-function: linear, ease-in-out;
            animation-iteration-count: 1, infinite;
        }

        .logo {
            width: 110px;
            height: 110px;
        }

        .big {
            animation-name: fall, tilt;
            animation-duration: var(--fallDur, 2200ms), 2.4s;
            animation-timing-function: linear, ease-in-out;
            animation-iteration-count: 1, infinite;
        }

        .overlay {
            position: absolute;
            inset: 0;
            background: rgba(0, 0, 0, .65);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }

        .modal {
            text-align: center;
            max-width: 90%;
        }

        .btn {
  background: rgba(255,215,179,.15);
  border: 1px solid rgba(255,215,179,.45);
  color: #ffd7b3;
  border-radius: 999px;
  padding: 10px 28px;
  letter-spacing: .5px;
  transition: all .25s ease;
  backdrop-filter: blur(8px);
}
.btn:hover {
  background: rgba(255,215,179,.25);
  box-shadow: 0 0 20px rgba(255,215,179,.35);
  transform: scale(1.05);
}

        .sheet {
            position: absolute;
            left: 0;
            right: 0;
            bottom: 0;
            background: #111;
            padding: 20px;
            border-top-left-radius: 18px;
            border-top-right-radius: 18px;
            z-index: 20;
            box-shadow: 0 -12px 30px rgba(0, 0, 0, .4);
            animation: slideUpFade .5s ease-out;
        }

        @keyframes slideUpFade {
  from { opacity: 0; transform: translateY(30px) scale(0.90); }
  to { opacity: 1; transform: translateY(0) scale(1); }
}

        .ring {
            position: absolute;
            width: 14px;
            height: 14px;
            border: 20px solid var(--brand);
            border-radius: 999px;
            pointer-events: none;
            opacity: .9;
            transform: translate(-50%, -50%) scale(.3);
            animation: ring 1.5s ease-out forwards;
        }

        @keyframes ring {
            to {
                opacity: 0;
                transform: translate(-50%, -50%) scale(1.8);
            }
        }

        .float {
            position: absolute;
            left: 0;
            top: 0;
            transform: translate(-50%, -50%);
            color: var(--gold);
            font-weight: 900;
            text-shadow: 0 2px 10px rgba(0, 0, 0, .5);
            pointer-events: none;
            animation: floatUp .9s ease-out forwards;
        }

        @keyframes floatUp {
            0% {
                opacity: 0;
                transform: translate(-50%, -30%) scale(1.4)
            }

            20% {
                opacity: 1
            }

            100% {
                opacity: 0;
                transform: translate(-50%, -120%) scale(1.1)
            }
        }

.confetti {
  position: absolute;
  width: 10px;
  height: 14px;
  border-radius: 4px;
  pointer-events: none;
  opacity: 0.9;
  animation: confDrop 1.2s cubic-bezier(0.33, 1, 0.68, 1);
}

@keyframes confDrop {
  0% {
    transform: translate(0, 0) rotate(0deg);
    opacity: 1;
  }
  100% {
    transform: translate(var(--dx), var(--dy)) rotate(var(--rot));
    opacity: 0;
  }
}


        .boom {
            position: absolute;
            width: 30px;
            height: 30px;
            border-radius: 70%;
            pointer-events: none;
            background: radial-gradient(circle, rgba(255, 220, 150, .95) 0%, rgba(255, 120, 0, .7) 45%, rgba(0, 0, 0, 0) 70%);
            transform: translate(-50%, -50%) scale(1.5);
            opacity: .95;
            box-shadow: 0 0 20px rgba(255, 140, 0, .8), 0 0 40px rgba(255, 100, 0, .6);
            animation: boom 1s ease-out forwards;
        }

        @keyframes boom {
            60% {
                transform: translate(-50%, -50%) scale(8);
                opacity: .85
            }

            100% {
                transform: translate(-50%, -50%) scale(8);
                opacity: 0
            }
        }

        .shake {
            animation: shake 850ms cubic-bezier(.36, .07, .19, .97);
        }

        @keyframes shake {

            10%,
            90% {
                transform: translate(-1px, 0)
            }

            20%,
            80% {
                transform: translate(2px, 0)
            }

            30%,
            50%,
            70% {
                transform: translate(-4px, 0)
            }

            40%,
            60% {
                transform: translate(4px, 0)
            }
        }

.rabat-glow {
  animation: rabatGlow 1.2s cubic-bezier(0.25, 1, 0.5, 1) forwards;
}

@keyframes rabatGlow {
  0% {
    color: #fff;
    text-shadow: 0 0 2px #ffd7b3, 0 0 8px rgba(255, 215, 179, 0.5);
  }
  35% {
    color: #ffd7b3;
    text-shadow:
      0 0 6px #ffd7b3,
      0 0 18px #ffe5c6,
      0 0 32px rgba(255, 215, 179, 0.3);
  }
  70% {
    color: #ffe5c6;
    text-shadow:
      0 0 10px #ffd7b3,
      0 0 28px rgba(255, 215, 179, 0.5);
  }
  100% {
    color: #fff;
    text-shadow: none;
  }
}


.wind {
  animation: wind 0.55s cubic-bezier(0.36, 0.07, 0.19, 0.97);
}

@keyframes wind {
  0% {
    transform: translateX(0);
  }
  20% {
    transform: translateX(-8px) rotate(-1deg);
  }
  45% {
    transform: translateX(6px) rotate(1deg);
  }
  70% {
    transform: translateX(-4px) rotate(-0.5deg);
  }
  100% {
    transform: translateX(0) rotate(0deg);
  }
}


.crit-flash {
  position: absolute;
  inset: 0;
  pointer-events: none;
  z-index: 9;
  /* –¥–≤–∞ —Å–ª–æ—è: —Ç—ë–ø–ª—ã–π —Ü–µ–Ω—Ç—Ä + –ª—ë–≥–∫–∞—è –≤–∏–Ω—å–µ—Ç–∫–∞ –ø–æ –∫—Ä–∞—è–º */
  background:
    radial-gradient(circle at 50% 50%,
      rgba(255,215,179,.25) 0%,
      rgba(255,215,179,.12) 35%,
      rgba(255,215,179,0) 70%),
    radial-gradient(circle at 50% 50%,
      rgba(0,0,0,.0) 60%,
      rgba(0,0,0,.25) 100%);
  animation: critFlash 1.1s cubic-bezier(.25,1,.5,1) forwards;
  will-change: opacity, transform;
}

@keyframes critFlash {
  0%   { opacity:.95; transform: scale(1.02); }
  60%  { opacity:.35; transform: scale(1.00); }
  100% { opacity:0;   transform: scale(1.00); }
}


        .crit-burst {
            position: absolute;
            width: 42px;
            height: 42px;
            border-radius: 999px;
            background: radial-gradient(circle, rgba(255, 215, 179, .95) 0%, rgba(255, 200, 120, .65) 45%, rgba(0, 0, 0, 0) 70%);
            box-shadow: 0 0 30px rgba(255, 200, 120, .9), 0 0 60px rgba(255, 160, 60, .7);
            transform: translate(-50%, -50%) scale(.6);
            opacity: .95;
            pointer-events: none;
            z-index: 8;
            animation: critBurst .9s ease-out forwards;
        }

        @keyframes critBurst {
            60% {
                transform: translate(-50%, -50%) scale(10);
                opacity: .85
            }

            100% {
                transform: translate(-50%, -50%) scale(10);
                opacity: 0
            }
        }

        .crit-ray {
            position: absolute;
            width: 6px;
            height: 26px;
            border-radius: 3px;
            background: linear-gradient(to bottom, rgba(255, 215, 179, 1), rgba(255, 215, 179, 0));
            transform-origin: center bottom;
            opacity: .95;
            pointer-events: none;
            z-index: 8;
            animation: critRay .7s ease-out forwards;
        }

        @keyframes critRay {
            60% {
                transform: translate(-50%, -50%) rotate(var(--rot)) scaleY(1.5);
                opacity: .9
            }

            100% {
                transform: translate(-50%, -50%) rotate(var(--rot)) scaleY(1.5) translateY(-24px);
                opacity: 0
            }
        }

        .tornado {
            width: 62px;
            height: 62px;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: fall var(--fallDur, 2200ms) linear forwards, spin 1.2s linear infinite, spawnFade .25s ease-out forwards;
            filter: drop-shadow(0 0 22px rgba(150, 200, 255, .6));
        }

        @keyframes spin {
            to {
                transform: rotate(360deg)
            }
        }

        @keyframes spawnFade {
            from {
                opacity: 0
            }

            to {
                opacity: 1
            }
        }

        .twist {
            position: absolute;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            border: 6px solid rgba(160, 200, 255, .85);
            opacity: .9;
            transform: translate(-50%, -50%) scale(.9);
            pointer-events: none;
            animation: twistOut .55s ease-out forwards;
            box-shadow: 0 0 10px rgba(140, 190, 255, .7);
        }

        .app::before {
            content: "";
            position: absolute;
            inset: 0;
            background: rgba(0, 0, 0, .55);
            pointer-events: none;
            z-index: 0;
        }

        @keyframes twistOut {
            70% {
                transform: translate(var(--dx), var(--dy)) scale(1.35);
                opacity: .7
            }

            100% {
                transform: translate(var(--dx), var(--dy)) scale(1.35);
                opacity: 0
            }
        }

        body::before {
            content: "";
            position: fixed;
            inset: 0;
            pointer-events: none;
            background: radial-gradient(circle at center, rgba(0, 0, 0, 0) 60%, rgba(0, 0, 0, .35) 100%);
            z-index: 1;
        }

        .vortex {
            position: absolute;
            left: 0;
            top: 0;
            pointer-events: none;
            width: 82px;
            height: 82px;
            border-radius: 50%;
            background: radial-gradient(circle at 50% 50%, rgba(170, 210, 255, .25), rgba(170, 210, 255, 0) 65%);
            box-shadow: 0 0 42px rgba(150, 200, 255, .45), inset 0 0 14px rgba(180, 220, 255, .35);
            transform: translate(-50%, -50%) scale(.6) rotate(0deg);
            animation: vortexSpin .9s ease-out forwards;
        }

        @keyframes vortexSpin {
            60% {
                transform: translate(-50%, -50%) scale(2.8) rotate(220deg);
                opacity: .9
            }

            100% {
                transform: translate(-50%, -50%) scale(3) rotate(260deg);
                opacity: 0
            }
        }

        .text-main {
            font-size: 20px;
            line-height: 1.55;
            color: #f3eee9;
            text-shadow: 0 1px 4px rgba(0, 0, 0, .45);
            font-weight: 400;
        }

        .text-list li {
            margin: 8px 0;
            font-size: 18px;
            color: #ffffffd8;
            text-shadow: 0 1px 3px rgba(0, 0, 0, .4);
        }

        .text-strong {
            font-weight: 700;
            color: #ffd7b3;
        }

        .text-muted {
            opacity: .88;
        }

        .text-title-small {
            font-size: 17px;
            color: #ffe5c7;
            font-weight: 600;
            margin-bottom: 6px;
            text-shadow: 0 1px 4px rgba(0, 0, 0, .5);
        }

        /* ROMA */
        .roma {
            position: absolute;
            top: -80px;
            width: 100px;
            height: 100px;
            object-fit: contain;
            cursor: pointer;
            user-select: none;
            touch-action: manipulation;
            border-radius: 50%;
            filter: drop-shadow(0 10px 18px rgba(0, 0, 0, .55)) drop-shadow(0 0 22px rgba(255, 168, 77, .45));
            box-shadow: 0 0 0 3px #ffa84d, 0 0 16px #ffa84d, 0 0 28px rgba(255, 168, 77, .55);
            animation-name: fall, tilt;
            animation-duration: var(--fallDur, 2000ms), 2.2s;
            animation-timing-function: linear, ease-in-out;
            animation-iteration-count: 1, infinite;
        }

        .app.slowmo .logo,
        .app.slowmo .super,
        .app.slowmo .big,
        .app.slowmo .tornado,
        .app.slowmo .bomb,
        .app.slowmo .roma {
            animation-duration: calc(var(--fallDur, 2000ms) * 2.8), 2.2s !important;
        }

        .app.slowmo::after {
            content: "";
            position: absolute;
            inset: 0;
            background: rgba(0, 0, 0, .22);
            pointer-events: none;
            z-index: 9;
        }

        /* PRISM FX */
.prism-core {
  position: absolute;
  left: 0;
  top: 0;
  transform: translate(-50%, -50%) scale(0.6);
  width: 90px;
  height: 90px;
  border-radius: 50%;
  pointer-events: none;
  z-index: 9;
  background:
    radial-gradient(circle at 50% 50%,
      rgba(255, 255, 255, 0.95) 0%,
      rgba(255, 255, 255, 0.0) 55%),
    conic-gradient(from 0deg,
      rgba(255, 215, 179, 0.8),
      rgba(255, 230, 200, 0.3),
      rgba(255, 215, 179, 0.8),
      rgba(255, 255, 255, 0.6),
      rgba(255, 215, 179, 0.8));
  box-shadow:
    0 0 24px rgba(255, 215, 179, 0.8),
    0 0 60px rgba(255, 215, 179, 0.4);
  filter: blur(0.5px) saturate(1.2);
  animation:
    prismPulse 1.1s ease-out forwards,
    prismSpin 2.4s linear infinite;
}

@keyframes prismPulse {
  0% {
    transform: translate(-50%, -50%) scale(0.6);
    opacity: 0.9;
  }
  60% {
    transform: translate(-50%, -50%) scale(1.4);
    opacity: 0.95;
  }
  100% {
    transform: translate(-50%, -50%) scale(1.6);
    opacity: 0;
  }
}

/* –º—è–≥–∫–æ–µ –≤—Ä–∞—â–µ–Ω–∏–µ –∫–æ–Ω—É—Å–Ω–æ–≥–æ –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞ */
@keyframes prismSpin {
  0% { transform: translate(-50%, -50%) scale(0.6) rotate(0deg); }
  100% { transform: translate(-50%, -50%) scale(0.6) rotate(360deg); }
}


        .prism-shard {
  position: absolute;
  left: 0;
  top: 0;
  transform: translate(-50%, -50%) rotate(var(--rot)) scale(1);
  width: 10px;
  height: 18px;
  border-radius: 2px;
  background: linear-gradient(180deg,
    rgba(255, 215, 179, 0.95) 0%,
    rgba(255, 235, 210, 0.6) 40%,
    rgba(255, 255, 255, 0) 100%);
  box-shadow:
    0 0 8px rgba(255, 215, 179, 0.6),
    0 0 18px rgba(255, 215, 179, 0.35);
  pointer-events: none;
  z-index: 9;
  opacity: 0.9;
  filter: blur(0.3px);
  animation: shardFly 0.9s ease-out forwards;
}

@keyframes shardFly {
  0% {
    transform: translate(-50%, -50%) rotate(var(--rot)) scale(0.8);
    opacity: 1;
  }
  60% {
    transform: translate(calc(-50% + var(--dx)), calc(-50% + var(--dy))) rotate(calc(var(--rot) + 40deg)) scale(1.2);
    opacity: 0.8;
  }
  100% {
    transform: translate(calc(-50% + var(--dx) * 1.4), calc(-50% + var(--dy) * 1.4)) rotate(calc(var(--rot) + 80deg)) scale(0.9);
    opacity: 0;
  }
}

        /* —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–æ–¥ —ç—Ñ—Ñ–µ–∫—Ç */
:root {
  --halo-size: 120px;
  --halo-color: #ffd7b3;            /* —Ñ–∏—Ä–º–µ–Ω–Ω—ã–π –∫—Ä–∞—Ñ—Ç */
  --halo-glow: rgba(255,215,179,.75);
}

.prism-halo {
  position: absolute;
  left: 0; top: 0;
  width: var(--halo-size);
  height: var(--halo-size);
  transform: translate(-50%, -50%) scale(.55);
  border-radius: 50%;
  pointer-events: none;
  z-index: 8;
  /* –∫–æ–ª—å—Ü–æ + –ª—ë–≥–∫–∞—è –ø—Ä–∏–∑–º–µ–Ω–Ω–∞—è –æ–∫–∞–Ω—Ç–æ–≤–∫–∞ —á–µ—Ä–µ–∑ conic-gradient */
  background:
    radial-gradient(circle, rgba(255,255,255,.12) 0 55%, transparent 60%),
    conic-gradient(from 0deg,
      rgba(255,215,179,.7),
      rgba(255,235,210,.35),
      rgba(255,215,179,.7),
      rgba(255,255,255,.5),
      rgba(255,215,179,.7));
  /* –º—è–≥–∫–æ–µ —Å–≤–µ—á–µ–Ω–∏–µ –≤–æ–∫—Ä—É–≥ */
  box-shadow:
    0 0 26px var(--halo-glow),
    0 0 60px rgba(255,215,179,.35);
  animation: haloExpand .85s cubic-bezier(.25,1,.5,1) forwards;
  will-change: transform, opacity;
}

@keyframes haloExpand {
  0%   { transform: translate(-50%, -50%) scale(.55); opacity:.95; }
  65%  { transform: translate(-50%, -50%) scale(2.3); opacity:.8; }
  100% { transform: translate(-50%, -50%) scale(2.6); opacity:0; }
}

/* –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: —Ç–æ–Ω–∫–æ–µ –≤–Ω–µ—à–Ω–µ–µ –∫–æ–ª—å—Ü–æ-—É–¥–∞—Ä–Ω–∞—è –≤–æ–ª–Ω–∞ */
.prism-halo::after {
  content:"";
  position:absolute; inset:0;
  border-radius:50%;
  background:
    radial-gradient(circle,
      rgba(255,215,179,.55) 0 2px,
      transparent 3px);
  transform: scale(.2);
  opacity:.9;
  animation: haloRing .8s ease-out forwards;
}

@keyframes haloRing {
  0%   { transform: scale(.2); opacity:.9; filter: blur(0); }
  70%  { transform: scale(2.6); opacity:.45; filter: blur(.5px); }
  100% { transform: scale(3);   opacity:0;   filter: blur(1px); }
}

/* —É–≤–∞–∂–µ–Ω–∏–µ –∫ prefers-reduced-motion */
@media (prefers-reduced-motion: reduce) {
  .prism-halo, .prism-halo::after { animation: none; opacity:.8; }
}


.prism-trail {
  position: absolute;
  left: 0;
  top: 0;
  transform: translate(-50%, -50%);
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: radial-gradient(circle,
    rgba(255, 215, 179, 0.95) 0%,
    rgba(255, 235, 210, 0.5) 40%,
    rgba(255, 255, 255, 0) 100%);
  box-shadow:
    0 0 10px rgba(255, 215, 179, 0.7),
    0 0 20px rgba(255, 215, 179, 0.35);
  pointer-events: none;
  z-index: 8;
  opacity: 0.9;
  filter: blur(0.4px);
  animation: trailFade 0.65s cubic-bezier(0.25, 1, 0.5, 1) forwards;
}

@keyframes trailFade {
  0% {
    transform: translate(-50%, -50%) scale(1);
    opacity: 0.9;
  }
  50% {
    opacity: 0.5;
    transform: translate(calc(var(--dx) * 0.5), calc(var(--dy) * 0.5)) scale(1.1);
  }
  100% {
    transform: translate(var(--dx), var(--dy)) scale(1.3);
    opacity: 0;
  }
}


        .totalGames-pop {
            animation: tgPop .45s ease-out forwards;
        }

        @keyframes tgPop {
            0% {
                transform: scale(1);
                color: #eee
            }

            40% {
                transform: scale(1.25);
                color: #ffd7b3
            }

            100% {
                transform: scale(1);
                color: #eee
            }
        }

        .app.slowmo .freeze-vignette {
  content: "";
  position: absolute;
  inset: 0;
  pointer-events: none;
  z-index: 10;
  background:
    radial-gradient(circle at 50% 50%,
      rgba(0, 0, 0, 0) 45%,
      rgba(0, 0, 0, 0.25) 75%,
      rgba(0, 0, 0, 0.4) 100%),
    radial-gradient(circle at 50% 50%,
      rgba(255, 215, 179, 0.05) 0%,
      rgba(0, 0, 0, 0) 60%);
  animation:
    vignetteBlink 0.35s cubic-bezier(0.25, 1, 0.5, 1),
    vignettePulse 2s ease-in-out infinite alternate;
  opacity: 0.9;
  mix-blend-mode: multiply;
}

@keyframes vignetteBlink {
  from {
    opacity: 0;
    filter: blur(2px);
  }
  to {
    opacity: 0.9;
    filter: blur(0);
  }
}

/* –ª—ë–≥–∫–æ–µ "–¥—ã—Ö–∞–Ω–∏–µ" –¥–ª—è –∂–∏–≤–æ—Å—Ç–∏ —ç—Ñ—Ñ–µ–∫—Ç–∞ */
@keyframes vignettePulse {
  0% {
    transform: scale(1);
    opacity: 0.9;
  }
  100% {
    transform: scale(1.02);
    opacity: 0.92;
  }
}

/* –ª—ë–≥–∫–∞—è —Ç—Ä—è—Å–∫–∞ */
@keyframes endShake {
  0%,100% { transform: translate(0,0); }
  25% { transform: translate(3px,-2px); }
  50% { transform: translate(-3px,2px); }
  75% { transform: translate(2px,3px); }
}

/* –º—è–≥–∫–∞—è —Ç—ë–ø–ª–∞—è –≤—Å–ø—ã—à–∫–∞ –ø–æ–≤–µ—Ä—Ö —Å—Ü–µ–Ω—ã */
@keyframes endFlash {
  0%   { opacity:.9; transform: scale(1.02); }
  70%  { opacity:.35; transform: scale(1); }
  100% { opacity:0;   transform: scale(1); }
}

/* —Ç—Ä–∏–≥–≥–µ—Ä–∏–º –æ–±–æ—ë —Å—Ä–∞–∑—É, –∫–æ–≥–¥–∞ –Ω–∞ .app –≤–µ—à–∞–µ—Ç—Å—è –∫–ª–∞—Å—Å end-wow */
.app.end-wow { animation: endShake .22s ease; }
.app.end-wow::before{
  content:"";
  position:absolute; inset:0; pointer-events:none;
  background:
    radial-gradient(circle at 50% 50%,
      rgba(255,215,179,.25) 0%,
      rgba(255,215,179,.12) 35%,
      rgba(255,215,179,0) 70%);
  animation: endFlash .9s cubic-bezier(.25,1,.5,1) forwards;
  z-index: 9; /* .sheet –ø–æ—Å—Ç–∞–≤—å z-index:10, —á—Ç–æ–±—ã –±—ã–ª–∞ –≤—ã—à–µ */
}

/* –Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π: –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω */
.app { position: relative; }
.sheet { position: absolute; z-index: 10; }

@keyframes coffeeSteam {
  0% {
    opacity: 0;
    transform: translate(-50%, 20px) scale(0.9);
  }
  10% {
    opacity: 0.6;
  }
  100% {
    opacity: 0;
    transform: translate(-50%, -80px) scale(1.2);
  }
}

/* –±–∞–∑–æ–≤—ã–π —Å—Ç–∏–ª—å –¥–ª—è ¬´–ø–∞—Ä–∞¬ª */
.coffee-steam {
  position: absolute;
  left: 50%;
  top: 50%;
  width: 60px;
  height: 120px;
  border-radius: 50%;
  background: radial-gradient(circle at 50% 80%, rgba(255, 215, 179, 0.25), rgba(255, 215, 179, 0));
  filter: blur(12px);
  opacity: 0;
  pointer-events: none;
  z-index: 8;
  transform: translate(-50%, 0);
  animation: coffeeSteam 2.2s ease-out forwards;
}

.rabat-glow-final {
  color: #ffe8cc;
  animation: finalGlow 1s ease-in-out infinite alternate;
}
@keyframes finalGlow {
  from {
    text-shadow:
      0 0 8px rgba(255,215,179,.4),
      0 0 15px rgba(255,215,179,.25);
  }
  to {
    text-shadow:
      0 0 20px rgba(255,215,179,1),
      0 0 40px rgba(255,215,179,.9),
      0 0 60px rgba(255,200,150,.7);
  }
}

@keyframes elephantSteam {
  0%   { opacity: 0; transform: translate(-50%, -10px) scale(.9);   filter: blur(6px); }
  15%  { opacity: .9;  transform: translate(-50%, -20px) scale(1);  filter: blur(2px); }
  100% { opacity: 0;   transform: translate(-50%, -90px) scale(1.15); filter: blur(8px); }
}
.steam-elephant {
  position: absolute;
  left: 50%; top: 50%;
  transform: translate(-50%, 0);
  width: 72px; height: 72px;
  pointer-events: none;
  z-index: 8;
  animation: elephantSteam 2.4s ease-out forwards;
  mix-blend-mode: screen;           /* –º—è–≥—á–µ –Ω–∞ —Ç—ë–º–Ω–æ–º —Ñ–æ–Ω–µ */
  opacity: 0;
}
.steam-elephant svg {
  width: 100%; height: 100%;
  fill: rgba(255, 215, 179, .85);   /* #ffd7b3 */
}

.btn#again{transition:transform .2s ease, box-shadow .2s ease}
.btn#again:hover{transform:translateY(-2px);box-shadow:0 10px 20px rgba(255,215,179,.25)}

/* --- –ú–û–î–ê–õ–ö–ê ELEPHANT COFFEE --- */

#startOv .modal {
    padding: 32px 38px;
    border-radius: 24px;

    /* —Ç—ë–ø–ª—ã–π –∫–æ—Ñ–µ–π–Ω—ã–π —Ñ–æ–Ω –≤–º–µ—Å—Ç–æ —á–µ—Ä–Ω–æ–≥–æ */
    background: rgba(40, 25, 15, 0.55);
    /* –º–æ–∂–Ω–æ —è—Ä—á–µ ‚Üí rgba(55, 38, 25, 0.58) */
    /* –∏–ª–∏ –º—è–≥—á–µ ‚Üí rgba(45, 30, 20, 0.48) */

    backdrop-filter: blur(18px);
    -webkit-backdrop-filter: blur(18px);

    box-shadow:
        0 10px 35px rgba(0,0,0,0.45),
        0 0 40px rgba(255,215,179,0.18);

    animation: modalEnter .6s ease-out;
}


/* –ü–ª–∞–≤–Ω–æ–µ –ø–æ—è–≤–ª–µ–Ω–∏–µ –º–æ–¥–∞–ª–∫–∏ */
@keyframes modalEnter {
    from {
        opacity: 0;
        transform: translateY(22px) scale(0.97);
    }
    to {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
}

/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ */
#startOv .modal h1 {
    text-align: center;
    margin-bottom: 12px;
    font-size: 32px !important;
    font-weight: 900;
    color: transparent;
    background: linear-gradient(90deg, #ffd7b3, #ffe9c8);
    -webkit-background-clip: text;
            background-clip: text;
    text-shadow: 0 0 22px rgba(255,215,179,.35);
}

/* –í—Å–µ –ø–∞—Ä–∞–≥—Ä–∞—Ñ—ã */
#startOv .modal p {
    color: #fff;
    font-size: 17px !important;
    line-height: 1.55 !important;
    margin: 10px 0 !important;
    opacity: .95;
    text-shadow: 0 2px 8px rgba(0,0,0,.55);
}

/* –ò–∫–æ–Ω–∫–∏ ü´ò üêò —Å–≤–µ—Ç—è—Ç—Å—è –º—è–≥–∫–∏–º —Å–≤–µ—Ç–æ–º */
#startOv .modal p span,
#startOv .modal p img {
    filter: drop-shadow(0 0 4px rgba(255,215,179,.75));
}

/* –ê–∫—Ü–µ–Ω—Ç–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ (–ø–æ—Å–ª–µ–¥–Ω–∏–π p —Å id=rulesText) */
#rulesText {
    font-size: 16px !important;
    color: #ffe7d0 !important;
    margin-top: 12px !important;
}
#rulesText::before {
    content: "‚Ä¢ ";
    color: #ffd7b3;
    font-size: 20px;
    vertical-align: middle;
}

/* –ö–Ω–æ–ø–∫–∞ —Å—Ç–∞—Ä—Ç */
#startOv .btn#start {
    margin-top: 16px;
    padding: 10px 26px;
    font-size: 18px;
    font-weight: 700;

    background: linear-gradient(90deg, #ffd7b3, #ffebb9);
    border: none;
    color: #000;
    border-radius: 14px;

    transition: transform .2s ease, box-shadow .2s ease;
    box-shadow: 0 4px 14px rgba(255,215,179,.35);
}

#startOv .btn#start:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 22px rgba(255,215,179,.45);
}

.rules-info {
    margin-top: 18px;
    line-height: 1.55;
    font-size: 16px;
    opacity: .82;
    color: #fff;
    text-align: left;
    max-width: 420px;
    margin-left: auto;
    margin-right: auto;
}

/* –æ–±—â–∏–π –æ—Ç—Å—Ç—É–ø —Å–µ–∫—Ü–∏–π –≤–Ω—É—Ç—Ä–∏ –º–æ–¥–∞–ª–∫–∏ */
.modal-section {
  margin-top: 18px;
}

/* –º–∞–ª–µ–Ω—å–∫–∏–π –ø–æ–¥–∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å–µ–∫—Ü–∏–∏ */
.section-title {
  font-size: 15px;
  letter-spacing: .08em;
  text-transform: uppercase;
  color: rgba(255, 231, 208, .9);
  margin: 0 0 6px;
}

/* –∫–æ—Ä–æ–±–∫–∞ —Å –ø—Ä–∞–≤–∏–ª–∞–º–∏ */
.rules-box {
  text-align: left;
}

/* —Å–ø–∏—Å–æ–∫ –ø—Ä–∞–≤–∏–ª */
.rules-list {
  list-style: none;
  padding: 0;
  margin: 0;
}

.rules-list li {
  display: flex;
  align-items: flex-start;
  gap: 6px;
  margin: 4px 0;
  color: #fff;
  font-size: 15px;
  line-height: 1.5;
  text-shadow: 0 2px 6px rgba(0,0,0,.6);
}

/* –∏–∫–æ–Ω–∫–∞-–≥–≤–æ–∑–¥–∏–∫ */
.rules-list .pin {
  flex: 0 0 auto;
  margin-top: 2px;
  filter: drop-shadow(0 0 6px rgba(255, 215, 179, .7));
}

/* –±–ª–æ–∫ —Å –æ—á–∫–∞–º–∏ –∑–∞ —ç–ª–µ–º–µ–Ω—Ç—ã */
.game-box {
  text-align: center;
  margin-top: 20px;
}

/* —Å–ø–∏—Å–æ–∫ –æ—á–∫–æ–≤ */
.game-list {
  list-style: none;
  padding: 0;
  margin: 4px 0 0;
  color: #ffe9d5;
  font-size: 15px;
  line-height: 1.5;
  text-shadow: 0 2px 6px rgba(0,0,0,.6);
}

.game-list li {
  margin: 3px 0;
}

/* –ø–æ–∑–∏—Ç–∏–≤–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è */
.game-list b {
  color: #ffd7b3;
}

/* –º–∏–Ω—É—Å–∞ ‚Äî —Å–ª–µ–≥–∫–∞ –∫—Ä–∞—Å–Ω—ã–µ */
.game-list b.minus {
  color: #ff8a7a;
}

/* –∏–∫–æ–Ω–∫–∞ –±–æ–º–±—ã */
.bomb-icon {
  filter: drop-shadow(0 0 6px rgba(255, 120, 120, .8));
}

/* üì± Mobile optimization */
@media (max-width: 480px) {

  /* —Å–∞–º–∞ –º–æ–¥–∞–ª–∫–∞ ‚Äî –¥–µ–ª–∞–µ–º –±–æ–ª–µ–µ –∫–æ–º–ø–∞–∫—Ç–Ω–æ–π */
  .modal {
    padding: 18px 20px !important;
  }

  /* –∑–∞–≥–æ–ª–æ–≤–æ–∫ */
  h1.title-anim {
    font-size: 24px !important;
    line-height: 1.25;
    margin-bottom: 10px;
  }

  /* –ø–æ–¥–∑–∞–≥–æ–ª–æ–≤–∫–∏ —Å–µ–∫—Ü–∏–π */
  .section-title {
    font-size: 13px;
    margin-bottom: 4px;
    text-align: center;
    letter-spacing: 0.06em;
  }

  /* —Å–ø–∏—Å–æ–∫ –ø—Ä–∞–≤–∏–ª */
  .rules-list li {
    font-size: 14px;
    line-height: 1.45;
    margin: 6px 0;
  }

  /* —É–º–µ–Ω—å—à–∏—Ç—å —Å–º–µ—â–µ–Ω–∏–µ –∏–∫–æ–Ω–æ–∫ */
  .rules-list .pin {
    margin-top: 1px;
  }

  /* –±–ª–æ–∫ –ø—Ä–∞–≤–∏–ª */
  .rules-box {
    margin-top: 14px;
  }

  /* –±–ª–æ–∫ —Å —Ü–µ–Ω–∞–º–∏ –∑–∞ —ç–ª–µ–º–µ–Ω—Ç—ã */
  .game-box {
    margin-top: 16px;
  }

  .game-list li {
    font-size: 14px;
    margin: 4px 0;
  }

  /* –∫–Ω–æ–ø–∫–∞ "Graj!" ‚Äî –∫—Ä—É–ø–Ω–µ–µ, –ø–∞–ª—å—Ü–µ–º —É–¥–æ–±–Ω–æ –Ω–∞–∂–∞—Ç—å */
  .btn#start,
  .btn#again {
    padding: 14px 24px !important;
    font-size: 17px !important;
    border-radius: 14px !important;
    margin-top: 12px;
  }

  /* —Å–∫–æ–ª—å–∫–æ –∏–≥—Ä —Å—ã–≥—Ä–∞–Ω–æ */
  #totalGamesInfo {
    font-size: 13px;
    margin-top: 10px !important;
  }
}

/* –û–±—â–∏–π —Å—Ç–∏–ª—å –±–ª–æ–∫–∞ —Å –Ω–∞–≥—Ä–∞–¥–∞–º–∏ (rulesText) */
#rulesText {
  margin-top: 16px;
  font-size: 16px;
  line-height: 1.6;
  color: #ffe9d5;
  text-align: center;
  text-shadow: 0 2px 6px rgba(0,0,0,.65);
}

/* –≤—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ <b> –¥–µ–ª–∞–µ–º —Ç—ë–ø–ª—ã–º–∏ –∏ ¬´–∂–∏–≤—ã–º–∏¬ª */
#rulesText b {
  color: #ffe5c6;
  text-shadow: 0 0 6px rgba(255,215,179,.55);
  display: inline-block;
  transition: transform .18s ease, text-shadow .18s ease;
}

/* –ª—ë–≥–∫–∏–π –ø–æ–¥—ä—ë–º –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ –Ω–∞ —Å—Ç—Ä–æ–∫—É */
#rulesText b:hover {
  transform: scale(1.06);
  text-shadow: 0 0 14px rgba(255,215,179,.9);
}

/* 4-–π –∏ 5-–π <b> ‚Äî –º–∏–Ω—É—Å–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è */
#rulesText b:nth-of-type(4),
#rulesText b:nth-of-type(5) {
  color: #ffb3b3;
  text-shadow: 0 0 10px rgba(255,80,80,.55);
}

/* 6-–π <b> ‚Äî ¬´3 sekundy¬ª */
#rulesText b:nth-of-type(6) {
  font-weight: 700;
  color: #ffffff;
  text-shadow: 0 0 10px rgba(255,255,255,.6);
}

#rulesText {
  opacity: 0;
  transform: translateY(8px) scale(.97);
  animation: rulesIn .45s ease-out .25s forwards;
}

@keyframes rulesIn {
  0%   { opacity: 0; transform: translateY(10px) scale(.04); }
  100% { opacity: 1; transform: translateY(0)    scale(1);   }
}


    </style>
</head>

<body>
    <div class="app" id="app">
        <div class="safe">
            <div class="pill">Czas: <b id="time">15.0</b>s</div>
            <div class="pill">Rabat: <b id="discount">0 z≈Ç</b></div>
        </div>
        <div class="overlay" id="startOv">
            <div class="modal">
<h1 class="title-anim">
    Gra od Elephant Coffee ‚Äî Z≈ÅAP S≈ÅONIA üêò
</h1>

<div class="modal-section rules-box">
    <h2 class="section-title">Zasady rabatu:</h2>
    <ul class="rules-list">
        <li>
            <span class="pin">üìå</span>
            Zni≈ºki z gry sƒÖ aktywne tylko w dniach og≈Çoszonej promocji.
        </li>
        <li>
            <span class="pin">üìå</span>
            Rabat dzia≈Ça przy zam√≥wieniach od 60 z≈Ç (wed≈Çug aktualnego cennika).
        </li>
        <li>
            <span class="pin">üìå</span>
            Wygrana kwota zostaje odjƒôta od ca≈Çego zam√≥wienia przy p≈Çatno≈õci.
        </li>
        <li>
            <span class="pin">üìå</span>
            Zni≈ºki z gry nie ≈ÇƒÖczƒÖ siƒô z innymi promocjami.
        </li>
        <li>
            <span class="pin">üìå</span>
            Jedna zni≈ºka z gry na osobƒô dziennie.
        </li>
        <li>
            <span class="pin">üìå</span>
            Rabat jest jednorazowy i niewymienny na got√≥wkƒô.
        </li>
        <li>
            <span class="pin">üìå</span>
            Zni≈ºki z kilku gier nie ≈ÇƒÖczƒÖ siƒô ‚Äî liczy siƒô tylko zni≈ºka z jednej rozgrywki.
        </li>
    </ul>
</div>

<div class="modal-section game-box" id="rulesText">
    <h2 class="section-title">Co daje ka≈ºde z≈Çapanie?</h2>
    <ul class="game-list">
        <li> Paczka kawy = <b>+0,10 z≈Ç</b></li>
        <li> Super S≈Ço≈Ñ Logo = <b>+0,80 z≈Ç</b></li>
        <li> Paczka z RƒôkƒÖ = <b>+0,50 z≈Ç</b></li>
        <li> <span class="bomb-icon">üí£</span> Bomba = <b class="minus">‚àí3 z≈Ç</b></li>
        <li> Zestaw trzech kaw = <b class="minus">‚àí0,40 z≈Ç</b></li>
        <li> Z≈Çap mnie ‚Äî spowolnienie czasu na <b>3 sekundy</b></li>
    </ul>
</div>

<button class="btn" id="start">Graj!</button>
<p id="totalGamesInfo" class="text-muted" style="margin-top:8px">Twoje rozegrane gry: 0</p>

            </div>
        </div>
    </div>

    <script>
        /* ===================== CONFIG ===================== */
        const CONFIG = {
            game: { duration: 15000, spawnInterval: 175, fallMin: 1800, fallMax: 2800, cap: 10, chSwim: 0.35, chEvade: 0.26 },
            ui: { background: 'url(./background.jpg) center center / cover no-repeat #000' },
            sounds: {
                enabled: true,
                bg: { src: 'background.mp3', volume: 0.35 },
                hit: { src: './hit.mp3', volume: 0.45, pool: 6 },
                bomb: { src: 'bomb.mp3', volume: 0.7 },
                tornado: { src: './tornado.mp3', volume: 0.6 }
            },
            elements: {
                normal: {
                    reward: 0.1, allowEvade: true, allowSwim: true, sound: { src: './basic.mp3', volume: 0.5, pool: 4 },
                    items: [
                        { src: 'basic.png', size: 56, note: '–ë—Ä–∞–∑–∏–ª–∏—è 250–≥', sound: { src: './pack250.mp3', volume: 0.55, pool: 3 } },
                        { src: 'basic.png', size: 56, note: 'Balance 70/30' },
                        { src: 'basic.png', size: 56, note: 'Brazil Santos' },
                        { src: 'basic.png', size: 56, note: 'Alternative' }
                    ],
                    fallbackSvg: `<svg xmlns='http://www.w3.org/2000/svg' width='56' height='56'><rect x='5' y='5' width='46' height='46' rx='8' fill='#ffd7b3'/></svg>`
                },
                super: {
                    reward: 0.80, size: 86, src: './logo.png', chance: 0.30, maxPerGame: 3, allowEvade: true, allowSwim: true,
                    sound: { src: './super.mp3', volume: 0.7 },
                    fallbackSvg: `<svg xmlns='http://www.w3.org/2000/svg' width='56' height='56'><circle cx='28' cy='28' r='26' fill='#ffd7b3'/></svg>`
                },
                big: { reward: 0.5, size: 185, src: './big.png', chance: 0.30, maxPerGame: 3, allowEvade: true, allowSwim: true, sound: { src: './hit.mp3', volume: 0.75 } },
                bomb: { reward: -3.0, size: 65, chance: 0.25, icon: 'üí£', imageSrc: '', allowEvade: false, allowSwim: true, sound: { src: './bomb.mp3', volume: 0.7 } },
                tornado: {
                    reward: -0.4, size: 80, chance: 0.05, src: 'tornado.png', allowEvade: true, allowSwim: true,
                    pull: { radius: 240, strength: 60, dur: 620 }, vibr: [40, 20, 60], sound: { src: './tornado.mp3', volume: 0.2 }
                },
                roma: {
                    reward: 0.0, size: 100, src: './roma.png', chance: 0.25, maxPerGame: 1, allowEvade: false, allowSwim: true,
                    fallMin: 2400, fallMax: 3600, sound: { src: './roma.mp3', volume: 0.7 },
                    fallbackSvg: `<svg xmlns='http://www.w3.org/2000/svg' width='64' height='64'><circle cx='32' cy='32' r='30' fill='#ffd7b3'/></svg>`
                }
            },
            vib: { normal: 18, super: 26, bomb: [80, 40, 120] }
        };
        /* ================================================== */

        const app = document.getElementById('app');
        const dEl = document.getElementById('discount');
        const tEl = document.getElementById('time');
        const startOv = document.getElementById('startOv');

        /* –°—á—ë—Ç—á–∏–∫ –∏–≥—Ä */
        const LS_KEYS = { total: 'ec_totalGames' };
        let totalGames = Number(localStorage.getItem(LS_KEYS.total) || 0);
        function renderTotalGames() {
            const el = document.getElementById('totalGamesInfo'); if (!el) return;
            el.textContent = `Twoje rozegrane gry: ${totalGames}`;
            el.classList.remove('totalGames-pop'); void el.offsetWidth; el.classList.add('totalGames-pop');
        }
        renderTotalGames();

        const zl = v => new Intl.NumberFormat('pl-PL', { style: 'currency', currency: 'PLN', maximumFractionDigits: (Math.abs(v) % 1 === 0 ? 0 : 2) }).format(v);
        const vibr = p => { if (!p) return; if (navigator.vibrate) try { navigator.vibrate(p) } catch (_) { } };
        const rand = (a, b) => Math.random() * (b - a) + a;
        const clamp = (n, a, b) => Math.max(a, Math.min(b, n));
        let running = false, discount = 0, superCount = 0, bigCount = 0, t0 = 0, spawnTimer = null;

        (function applyBackground() { if (CONFIG?.ui?.background) app.style.background = CONFIG.ui.background; })();

        (function setRules() {
            const E = CONFIG.elements;
            const txt = [
                ` Paczka kawy = <b>+${zl(E.normal.reward)}</b>`,
                `‚Ä¢ Super S≈Ço≈Ñ Logo = <b>+${zl(E.super.reward)}</b>`,
                `‚Ä¢ Paczka z RƒôkƒÖ = <b>+${zl(E.big.reward)}</b>`,
                `üí£ Bomba = <b>${zl(E.bomb.reward)}</b>`,
                `‚Ä¢ Zestaw trzech kaw = <b>${zl(E.tornado.reward)}</b>`,
                `‚Ä¢ Z≈Çap mnie ‚Äî spowolnienie czasu na <b>3 sekundy</b>`
            ].join('<br>');
            document.getElementById('rulesText').innerHTML = txt;
        })();

        /* –ê—É–¥–∏–æ */
        const SND = {}; let __idx = 0; let bgMusic = null;
        function regSound(key, cfg) {
            if (!cfg || !cfg.src) return; const { src, volume = 1, pool = 1 } = cfg;
            if (pool > 1) { SND[key] = Array.from({ length: pool }, () => { const a = new Audio(src); a.volume = volume; a.preload = 'auto'; return a; }); }
            else { const a = new Audio(src); a.volume = volume; a.preload = 'auto'; SND[key] = a; }
        }
        function play(key) {
            if (!CONFIG.sounds.enabled) return; const s = SND[key]; if (!s) return;
            if (Array.isArray(s)) { const a = s[(__idx++ % s.length)]; try { a.currentTime = 0; a.play(); } catch { } }
            else { try { s.currentTime = 0; s.play(); } catch { } }
        }
        (function setupAudio() {
            if (!CONFIG.sounds.enabled) return;
            const SS = CONFIG.sounds;
            if (SS.bg && SS.bg.src) { bgMusic = new Audio(SS.bg.src); bgMusic.loop = true; bgMusic.volume = SS.bg.volume ?? 1; bgMusic.preload = 'auto'; }
            regSound('hit', SS.hit); regSound('bomb', SS.bomb); regSound('tornado', SS.tornado);
            const E = CONFIG.elements;
            regSound('el.normal', E.normal.sound); regSound('el.super', E.super.sound); regSound('el.big', E.big.sound);
            regSound('el.bomb', E.bomb.sound); regSound('el.tornado', E.tornado.sound); regSound('el.roma', E.roma.sound);
            (E.normal.items || []).forEach((it, i) => regSound(`el.normal.${i}`, it.sound));
        })();

        /* UI —ç—Ñ—Ñ–µ–∫—Ç—ã */
        function ring(x, y) { const r = document.createElement('div'); r.className = 'ring'; r.style.left = x + 'px'; r.style.top = y + 'px'; app.appendChild(r); setTimeout(() => r.remove(), 520); }
        function confetti(x, y, n = 14) {
            const colors = ['#ffd7b3', '#ffd700', '#ffa84d', '#ffffff'];
            for (let i = 0; i < n; i++) {
                const c = document.createElement('div'); c.className = 'confetti'; c.style.left = x + 'px'; c.style.top = y + 'px';
                c.style.background = colors[Math.floor(Math.random() * colors.length)];
                const dx = (Math.random() < .5 ? -1 : 1) * (20 + Math.random() * 60), dy = -(20 + Math.random() * 60), rot = (Math.random() < .5 ? -1 : 1) * (120 + Math.random() * 180) + 'deg';
                c.style.setProperty('--dx', dx + 'px'); c.style.setProperty('--dy', dy + 'px'); c.style.setProperty('--rot', rot);
                app.appendChild(c); setTimeout(() => c.remove(), 1000);
            }
        }
        function lightningFX(x, y) {
            const core = document.createElement('div'); core.className = 'lightning-burst'; core.style.left = x + 'px'; core.style.top = y + 'px'; app.appendChild(core); setTimeout(() => core.remove(), 350);
            const rays = 10; for (let i = 0; i < rays; i++) {
                const r = document.createElement('div'); r.className = 'lightning-ray'; r.style.left = x + 'px'; r.style.top = y + 'px';
                const angle = (i / rays) * Math.PI * 2; const dist = 40 + Math.random() * 60;
                r.style.setProperty('--dx', Math.cos(angle) * dist + 'px'); r.style.setProperty('--dy', Math.sin(angle) * dist + 'px');
                r.style.setProperty('--rot', (angle * 180 / Math.PI + (Math.random() * 40 - 20)) + 'deg');
                app.appendChild(r); setTimeout(() => r.remove(), 350);
            }
        }
        function floatLabel(x, y, text) { const f = document.createElement('div'); f.className = 'float'; f.textContent = text; f.style.left = x + 'px'; f.style.top = y + 'px'; app.appendChild(f); setTimeout(() => f.remove(), 900); }
        const celebrate = (x, y, text) => { ring(x, y); confetti(x, y); floatLabel(x, y, text); };
        function boom(x, y) { const b = document.createElement('div'); b.className = 'boom'; b.style.left = x + 'px'; b.style.top = y + 'px'; app.appendChild(b); setTimeout(() => b.remove(), 650); }
        function shake() { app.classList.remove('shake'); void app.offsetWidth; app.classList.add('shake'); }
        function windGust() { app.classList.remove('wind'); void app.offsetWidth; app.classList.add('wind'); }

        const CRIT_CONFETTI = 28, CRIT_RAYS = 10, CRIT_VIB = 40;
        function confettiRich(x, y, amount = 24) {
            const colors = ['#ffd7b3', '#ffd700', '#ffa84d', '#fff5da', '#ffffff'];
            for (let i = 0; i < amount; i++) {
                const c = document.createElement('div'); c.className = 'confetti'; c.style.left = x + 'px'; c.style.top = y + 'px';
                c.style.background = colors[Math.floor(Math.random() * colors.length)];
                const dx = (Math.random() < .5 ? -1 : 1) * (30 + Math.random() * 80), dy = -(30 + Math.random() * 80), rot = (Math.random() < .5 ? -1 : 1) * (140 + Math.random() * 220) + 'deg';
                c.style.setProperty('--dx', dx + 'px'); c.style.setProperty('--dy', dy + 'px'); c.style.setProperty('--rot', rot);
                app.appendChild(c); setTimeout(() => c.remove(), 1000);
            }
        }
        function critCelebrate(x, y, text) {
            ring(x, y); confettiRich(x, y, CRIT_CONFETTI); floatLabel(x, y, text);
            const b = document.createElement('div'); b.className = 'crit-burst'; b.style.left = x + 'px'; b.style.top = y + 'px'; app.appendChild(b); setTimeout(() => b.remove(), 720);
            for (let i = 0; i < CRIT_RAYS; i++) {
                const r = document.createElement('div'); r.className = 'crit-ray'; r.style.left = x + 'px'; r.style.top = y + 'px';
                const base = (360 / CRIT_RAYS) * i, jitter = (Math.random() * 18) - 9; r.style.setProperty('--rot', (base + jitter) + 'deg'); app.appendChild(r); setTimeout(() => r.remove(), 720);
            }
            const f = document.createElement('div'); f.className = 'crit-flash'; app.appendChild(f); setTimeout(() => f.remove(), 360);
        }

        function flashCrit() {
                const f = document.createElement('div');
                f.className = 'crit-flash';         // –∏–ª–∏ 'crit-ring'
                document.querySelector('.app').appendChild(f);
                f.addEventListener('animationend', () => f.remove());
            }

        function twistBurst(x, y, n = 8) {
            for (let i = 0; i < n; i++) {
                const t = document.createElement('div'); t.className = 'twist'; t.style.left = x + 'px'; t.style.top = y + 'px';
                const ang = (Math.PI * 2 / n) * i + (Math.random() * 0.6 - 0.3), r = 26 + Math.random() * 24;
                t.style.setProperty('--dx', (Math.cos(ang) * r) + 'px'); t.style.setProperty('--dy', (Math.sin(ang) * r) + 'px');
                app.appendChild(t); setTimeout(() => t.remove(), 560);
            }
        }
        function vortex(x, y) { const v = document.createElement('div'); v.className = 'vortex'; v.style.left = x + 'px'; v.style.top = y + 'px'; app.appendChild(v); setTimeout(() => v.remove(), 620); }

        function romaPrismFX(x, y) {
            const core = document.createElement('div'); core.className = 'prism-core'; core.style.left = x + 'px'; core.style.top = y + 'px'; app.appendChild(core); setTimeout(() => core.remove(), 720);
            const halo = document.createElement('div'); halo.className = 'prism-halo'; halo.style.left = x + 'px'; halo.style.top = y + 'px'; app.appendChild(halo); setTimeout(() => halo.remove(), 820);
            const shards = 26; for (let i = 0; i < shards; i++) {
                const s = document.createElement('div'); s.className = 'prism-shard'; s.style.left = x + 'px'; s.style.top = y + 'px';
                const ang = (i / shards) * Math.PI * 2 + (Math.random() * 0.35 - 0.175), r = 60 + Math.random() * 110;
                s.style.setProperty('--dx', Math.cos(ang) * r + 'px'); s.style.setProperty('--dy', Math.sin(ang) * r + 'px'); s.style.setProperty('--rot', (Math.random() * 260 - 130) + 'deg');
                s.style.filter = `hue-rotate(${Math.floor(Math.random() * 360)}deg)`; app.appendChild(s); setTimeout(() => s.remove(), 950);
            }
            const trails = 16; for (let i = 0; i < trails; i++) {
                const t = document.createElement('div'); t.className = 'prism-trail'; t.style.left = x + 'px'; t.style.top = y + 'px';
                const ang = Math.random() * Math.PI * 2, r = 30 + Math.random() * 70;
                t.style.setProperty('--dx', Math.cos(ang) * r + 'px'); t.style.setProperty('--dy', Math.sin(ang) * r + 'px'); app.appendChild(t); setTimeout(() => t.remove(), 620);
            }
            const vg = document.createElement('div'); vg.className = 'freeze-vignette'; app.appendChild(vg); setTimeout(() => vg.remove(), 260);
        }

        function shardsBurst(x, y, n = 24) {
            for (let i = 0; i < n; i++) {
                const d = document.createElement('div'); d.style.position = 'absolute'; d.style.left = x + 'px'; d.style.top = y + 'px'; d.style.width = 0; d.style.height = 0;
                const col = Math.random() < .5 ? '#ffa84d' : '#ffd7b3'; const s = 10 + Math.random() * 12;
                d.style.borderLeft = `${s}px solid transparent`; d.style.borderRight = `${s}px solid transparent`; d.style.borderBottom = `${s * 1.6}px solid ${col}`;
                d.style.filter = 'drop-shadow(0 2px 8px rgba(0,0,0,.45))'; d.style.pointerEvents = 'none';
                const ang = Math.random() * Math.PI * 2, dist = 60 + Math.random() * 140, tx = Math.cos(ang) * dist, ty = Math.sin(ang) * dist * (Math.random() < .4 ? 1.6 : 1.0);
                d.animate([{ transform: 'translate(-50%,-50%) rotate(0deg)', opacity: 1 }, { transform: `translate(${tx - 50}px, ${ty - 50}px) rotate(${(Math.random() * 360) | 0}deg)`, opacity: 0 }],
                    { duration: 700 + Math.random() * 600, easing: 'cubic-bezier(.2,.7,.2,1)', fill: 'forwards' });
                app.appendChild(d); setTimeout(() => d.remove(), 1400);
            }
        }

        

        /* –¢–∞–±–ª–∏—Ü–∞ –ª–∏–¥–µ—Ä–æ–≤ (top-3) */
        const LB_KEY = 'ec_leaderboard_v1';
        function loadScores() { try { return JSON.parse(localStorage.getItem(LB_KEY) || '[]'); } catch { return []; } }
        function saveScore(name, score) {
            const arr = loadScores();
            arr.push({ name: String(name || 'Go≈õƒá').slice(0, 16), score: Number(score) || 0, ts: Date.now() });
            arr.sort((a, b) => b.score - a.score);
            const top = arr.slice(0, 3);            // <- TOP-3
            localStorage.setItem(LB_KEY, JSON.stringify(top));
            return top;
        }
        function renderLeaderboardHTML(list) {
            list = (list || []).slice(0, 3);            // <- TOP-3
            if (!list.length) return '<p class="text-muted" style="text-align:center">Brak wynik√≥w ‚Äî bƒÖd≈∫ pierwszy!</p>';
            const rows = list.map((it, i) => `
        <tr>
          <td style="padding:6px 10px">${i + 1}</td>
          <td style="padding:6px 10px">${it.name}</td>
          <td style="padding:6px 10px; text-align:right">${zl(it.score)}</td>
        </tr>`).join('');
            return `
        <div style="margin-top:12px">
          <h3 style="margin:8px 0 6px 0">üèÜ Tablica wynik√≥w</h3>
          <table style="width:100%; border-collapse:collapse; font-weight:600; background:#141414; border:1px solid #222; border-radius:12px; overflow:hidden">
            <thead>
              <tr style="background:#191919">
                <th style="text-align:left; padding:6px 10px; width:50px">#</th>
                <th style="text-align:left; padding:6px 10px">Imiƒô</th>
                <th style="text-align:right; padding:6px 10px">Wynik</th>
              </tr>
            </thead>
            <tbody>${rows}</tbody>
          </table>
        </div>`;
        }

        /* SLOW-MO */
        let slowmoTimerId = null;
        function enterSlowmo(ms = 3000) { app.classList.add('slowmo'); try { if (navigator.vibrate) navigator.vibrate([40, 60, 40]); } catch { }; if (slowmoTimerId) { clearTimeout(slowmoTimerId); slowmoTimerId = null; } slowmoTimerId = setTimeout(exitSlowmo, ms); }
        function exitSlowmo() { app.classList.remove('slowmo'); if (slowmoTimerId) { clearTimeout(slowmoTimerId); slowmoTimerId = null; } }

        function update() { const cap = CONFIG.game.cap; if (discount < 0) discount = 0; if (discount > cap) discount = cap; dEl.textContent = zl(discount); }

        function fallSetup(el, { allowEvade = true, allowSwim = true, size = 56, customDur = null } = {}) {
            const G = CONFIG.game;
            el.style.left = rand(0, app.clientWidth - size) + 'px';
            if (Math.random() < 0.25) el.style.setProperty('--rot', (Math.random() < 0.5 ? -1 : 1) * rand(120, 360) + 'deg');
            const dur = (customDur ?? rand(G.fallMin, G.fallMax));
            el.style.top = '-80px'; el.style.setProperty('--fallDur', dur + 'ms'); el.style.animation = 'fall ' + dur + 'ms linear forwards';
            el.addEventListener('animationend', () => el.remove(), { once: true });
            if (allowSwim && Math.random() < G.chSwim) {
                const amp = 16 + Math.random() * 20, freq = 0.5 + Math.random() * 0.7, vel = (Math.random() < 0.5 ? -1 : 1) * (8 + Math.random() * 20);
                const x0 = parseFloat(el.style.left) || 0, start = performance.now();
                (function swim() {
                    if (!el.isConnected) return; const t = (performance.now() - start) / 1000;
                    const nx = x0 + vel * t + amp * Math.sin(2 * Math.PI * freq * t); el.style.left = clamp(nx, 0, app.clientWidth - size) + 'px'; el.__swim = requestAnimationFrame(swim);
                })();
                el.addEventListener('animationend', () => cancelAnimationFrame(el.__swim || 0), { once: true });
            }
            if (allowEvade) {
                const tryEvade = () => { if (Math.random() < G.chEvade) { vibr(12); const x = (parseFloat(el.style.left) || 0) + (Math.random() < 0.5 ? -1 : 1) * rand(110, 180); el.style.left = clamp(x, 0, app.clientWidth - size) + 'px'; } };
                el.addEventListener('pointerdown', tryEvade); el.addEventListener('pointerenter', tryEvade);
            }
            app.appendChild(el);
        }

        /* –§–∞–±—Ä–∏–∫–∏ */
        const svgToDataUri = svg => "data:image/svg+xml;utf8," + encodeURIComponent(svg);
        function makeNormal() {
            const N = CONFIG.elements.normal; const idx = Math.floor(Math.random() * N.items.length); const pick = N.items[idx] || { src: '', size: 56 };
            const img = new Image(); img.decoding = 'async'; img.loading = 'eager'; img.src = pick.src || svgToDataUri(N.fallbackSvg); img.onerror = () => { img.onerror = null; img.src = svgToDataUri(N.fallbackSvg); };
            const key = SND[`el.normal.${idx}`] ? `el.normal.${idx}` : (SND['el.normal'] ? 'el.normal' : 'hit');
            return { el: img, size: pick.size || 56, reward: N.reward, allowEvade: N.allowEvade, allowSwim: N.allowSwim, soundKey: key };
        }
        function makeSuper() {
            const S = CONFIG.elements.super; const img = new Image(); img.decoding = 'async'; img.loading = 'eager'; img.src = S.src || svgToDataUri(S.fallbackSvg); img.onerror = () => { img.onerror = null; img.src = svgToDataUri(S.fallbackSvg); }; const key = SND['el.super'] ? 'el.super' : 'hit';
            return { el: img, size: S.size, reward: S.reward, allowEvade: S.allowEvade, allowSwim: S.allowSwim, soundKey: key };
        }
        function makeBig() {
            const B = CONFIG.elements.big; const img = new Image(); img.decoding = 'async'; img.loading = 'eager'; img.src = B.src || ''; const key = SND['el.big'] ? 'el.big' : 'hit';
            return { el: img, size: B.size, reward: B.reward, allowEvade: B.allowEvade, allowSwim: B.allowSwim, soundKey: key };
        }
        function makeBomb() {
            const B = CONFIG.elements.bomb; let node, isImage = false; if (B.imageSrc) { const img = new Image(); img.decoding = 'async'; img.loading = 'eager'; img.src = B.imageSrc; node = img; isImage = true; } else { const div = document.createElement('div'); div.className = 'bomb'; div.textContent = B.icon || 'üí£'; node = div; }
            const key = SND['el.bomb'] ? 'el.bomb' : 'bomb'; return { el: node, size: B.size, reward: B.reward, allowEvade: B.allowEvade, allowSwim: B.allowSwim, isImage, soundKey: key };
        }
        function makeTornado() {
            const T = CONFIG.elements.tornado; const div = document.createElement('div'); div.className = 'tornado';
            if (T.src) { const img = new Image(); img.src = T.src; img.style.width = (T.size - 8) + 'px'; img.style.height = (T.size - 8) + 'px'; img.style.pointerEvents = 'none'; img.onerror = () => img.remove(); div.appendChild(img); }
            const key = SND['el.tornado'] ? 'el.tornado' : 'tornado'; return { el: div, size: T.size, reward: T.reward, allowEvade: T.allowEvade, allowSwim: T.allowSwim, soundKey: key };
        }
        function makeRoma() {
            const R = CONFIG.elements.roma; const img = new Image(); img.decoding = 'async'; img.loading = 'eager'; img.src = R.src || svgToDataUri(R.fallbackSvg); img.onerror = () => { img.onerror = null; img.src = svgToDataUri(R.fallbackSvg); };
            const key = SND['el.roma'] ? 'el.roma' : (SND['el.super'] ? 'el.super' : 'hit'); return { el: img, size: R.size, reward: R.reward, allowEvade: R.allowEvade, allowSwim: R.allowSwim, soundKey: key };
        }

        /* –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ */
        let tickNo = 0, superTick = null, bigTicks = new Set(), romaCount = 0, romaTick = null;
        const randi = (a, b) => Math.floor(Math.random() * (b - a + 1)) + a;

        function planSpecials() {
            const totalTicks = Math.floor(CONFIG.game.duration / CONFIG.game.spawnInterval);
            const superWin = [0.35, 0.85], bigWin = [0.15, 0.95], minGapMs = 2500, minGapTicks = Math.ceil(minGapMs / CONFIG.game.spawnInterval);
            superTick = randi(Math.floor(totalTicks * superWin[0]), Math.floor(totalTicks * superWin[1]));
            bigTicks.clear(); const want = CONFIG.elements.big.maxPerGame || 0; const minT = Math.floor(totalTicks * bigWin[0]); const maxT = Math.floor(totalTicks * bigWin[1]);
            while (bigTicks.size < want && (maxT - minT + 1) > 0) {
                const t = randi(minT, maxT); let ok = Math.abs(t - superTick) >= minGapTicks;
                if (ok) for (const bt of bigTicks) { if (Math.abs(t - bt) < minGapTicks) { ok = false; break; } }
                if (ok) bigTicks.add(t);
            }
            const romaWin = [0.40, 0.88]; const minGapTicksAll = Math.ceil(2500 / CONFIG.game.spawnInterval);
            romaTick = randi(Math.floor(totalTicks * romaWin[0]), Math.floor(totalTicks * romaWin[1]));
            let tries = 40;
            while (tries-- > 0) {
                let ok = Math.abs(romaTick - superTick) >= minGapTicksAll;
                if (ok) for (const bt of bigTicks) { if (Math.abs(romaTick - bt) < minGapTicksAll) { ok = false; break; } }
                if (ok) break;
                romaTick = randi(Math.floor(totalTicks * romaWin[0]), Math.floor(totalTicks * romaWin[1]));
            }
        }

        /* –°–ø–∞–≤–Ω */
        function spawn() {
            if (!running) return;
            const E = CONFIG.elements;
            const cur = tickNo++;
            if (E.roma?.maxPerGame && romaCount < (E.roma.maxPerGame || 1) && cur === romaTick) { romaCount++; spawnRoma(); return; }
            if (E.super.maxPerGame && superCount < (E.super.maxPerGame || 1) && cur === superTick) { superCount++; spawnSuper(); return; }
            if (bigTicks.size && bigTicks.has(cur) && bigCount < (E.big.maxPerGame || 0)) { bigCount++; spawnBig(); return; }
            const r = Math.random();
            if (r < (E.bomb.chance || 0)) { spawnBomb(); return; }
            if (r < (E.bomb.chance || 0) + (E.tornado.chance || 0)) { spawnTornado(); return; }
            spawnNormal();
        }

        /* –°—É—â–Ω–æ—Å—Ç–∏ */
        function spawnNormal() {
            const n = makeNormal(); n.el.className = 'logo'; fallSetup(n.el, { allowEvade: n.allowEvade, allowSwim: n.allowSwim, size: n.size });
            n.el.addEventListener('pointerdown', e => { play(n.soundKey || 'hit'); vibr(CONFIG.vib.normal); onHit(n.reward, zl(n.reward))(e); }, { once: true });
        }
        function spawnSuper() {
            const s = makeSuper(); s.el.className = 'super'; fallSetup(s.el, { allowEvade: s.allowEvade, allowSwim: s.allowSwim, size: s.size });
            s.el.addEventListener('pointerdown', e => {
                play(s.soundKey || 'hit');
                vibr(CONFIG.vib.super + CRIT_VIB);      // –æ—Å—Ç–∞–≤–∏–ª–∏ –æ–¥–Ω—É –≤–∏–±—Ä–∞—Ü–∏—é
                lightningFX(e.clientX, e.clientY);
                onHit(s.reward, zl(s.reward))(e);
                critCelebrate(e.clientX, e.clientY, '+' + zl(s.reward));
            }, { once: true });
        }
        function spawnBig() {
            const b = makeBig(); b.el.className = 'big'; fallSetup(b.el, { allowEvade: b.allowEvade, allowSwim: b.allowSwim, size: b.size });
            b.el.addEventListener('pointerdown', e => { play(b.soundKey || 'hit'); vibr(CONFIG.vib.normal + 10); onHit(b.reward, zl(b.reward))(e); }, { once: true });
        }
        function spawnBomb() {
            const b = makeBomb(); if (!b.isImage) b.el.classList.add('bomb'); fallSetup(b.el, { allowEvade: b.allowEvade, allowSwim: b.allowSwim, size: b.size });
            b.el.addEventListener('pointerdown', e => { play(b.soundKey || 'bomb'); vibr(CONFIG.vib.bomb); boom(e.clientX, e.clientY); shake(); onHit(b.reward, '')(e); }, { once: true });
        }
        function spawnTornado() {
            const t = makeTornado(); t.el.className = 'tornado'; fallSetup(t.el, { allowEvade: t.allowEvade, allowSwim: t.allowSwim, size: t.size });
            t.el.addEventListener('pointerdown', e => { play(t.soundKey || 'tornado'); vibr(CONFIG.elements.tornado.vibr); twistBurst(e.clientX, e.clientY, 10); vortex(e.clientX, e.clientY); windGust(); pullNearby(e.clientX, e.clientY, CONFIG.elements.tornado.pull); onHit(t.reward, '')(e); }, { once: true });
        }
        function spawnRoma() {
            const r = makeRoma(); r.el.className = 'roma';
            const frMin = CONFIG.elements.roma.fallMin || CONFIG.game.fallMin; const frMax = CONFIG.elements.roma.fallMax || CONFIG.game.fallMax; const dur = rand(frMin, frMax);
            fallSetup(r.el, { allowEvade: r.allowEvade, allowSwim: r.allowSwim, size: r.size, customDur: dur });
            r.el.addEventListener('pointerdown', e => {
                play(r.soundKey || 'hit'); vibr([30, 50, 30]);
                shardsBurst(e.clientX, e.clientY, 28); romaPrismFX(e.clientX, e.clientY); shake(); enterSlowmo(3000); e.currentTarget.remove();
            }, { once: true });
        }
        function spawnShard(x, y) {
                const el = document.createElement('div');
                el.className = 'prism-shard';
                el.style.left = `${x}px`;
                el.style.top = `${y}px`;
                el.style.setProperty('--dx', `${(Math.random() - 0.5) * 160}px`);
                el.style.setProperty('--dy', `${(Math.random() - 0.5) * 120}px`);
                el.style.setProperty('--rot', `${Math.random() * 360}deg`);
                document.body.appendChild(el);
                el.addEventListener('animationend', () => el.remove());
            }

            function spawnHalo(x, y) {
                    const el = document.createElement('div');
                    el.className = 'prism-halo';
                    el.style.left = x + 'px';
                    el.style.top = y + 'px';
                    document.querySelector('.app').appendChild(el);
                    el.addEventListener('animationend', () => el.remove());
                }
            
            function spawnTrail(x, y) {
                    const t = document.createElement('div');
                    t.className = 'prism-trail';
                    t.style.left = `${x}px`;
                    t.style.top = `${y}px`;
                    t.style.setProperty('--dx', `${(Math.random() - 0.5) * 40}px`);
                    t.style.setProperty('--dy', `${(Math.random() - 0.5) * 40}px`);
                    document.querySelector('.app').appendChild(t);
                    t.addEventListener('animationend', () => t.remove());
                }

             


                    document.addEventListener('pointerdown', e => {
                        coffeeDust(e.clientX, e.clientY);
                    });

    function spawnCoffeeSteam() {
        const app = document.querySelector('.app');
        if (!app) return;

        const steam = document.createElement('div');
        steam.className = 'coffee-steam';
        app.appendChild(steam);
        steam.addEventListener('animationend', () => steam.remove());
    }


        /* –¢–æ—Ä–Ω–∞–¥–æ –ø—Ä–∏—Ç—è–∂–µ–Ω–∏–µ */
        function pullNearby(x, y, { radius = 220, strength = 60, dur = 620 } = {}) {
            const start = performance.now(); const elems = Array.from(document.querySelectorAll('.logo,.super,.big'));
            const meta = elems.map(el => { const r = el.getBoundingClientRect(); return { el, w: r.width, h: r.height }; });
            function step(now) {
                const t = Math.min(1, (now - start) / dur); const ease = t < .5 ? (2 * t * t) : (-1 + (4 - 2 * t) * t);
                meta.forEach(({ el, w }) => {
                    if (!el.isConnected) return;
                    const r = el.getBoundingClientRect(), cx = r.left + r.width / 2, cy = r.top + r.height / 2;
                    const dx = x - cx, dy = y - cy, dist = Math.hypot(dx, dy); if (dist > radius) return;
                    const k = (1 - dist / radius) * strength * ease; const curLeft = parseFloat(el.style.left) || 0;
                    const nx = curLeft + (dx / (dist || 1)) * k; el.style.left = clamp(nx, 0, app.clientWidth - w) + 'px';
                    const curRot = parseFloat(getComputedStyle(el).getPropertyValue('--rot')) || 0; el.style.setProperty('--rot', (curRot + (dx > 0 ? 8 : -8) * ease) + 'deg');
                });
                if (t < 1) requestAnimationFrame(step);
            }
            requestAnimationFrame(step);
        }

        /* –ü–æ–ø–∞–¥–∞–Ω–∏–µ */
        function onHit(delta, label) {
            return e => {
                if (!running) return;
                discount += delta; update();
                dEl.classList.add('rabat-glow'); setTimeout(() => dEl.classList.remove('rabat-glow'), 800);
                const p = { x: e?.clientX || 0, y: e?.clientY || 0 }; if (delta > 0) celebrate(p.x, p.y, '+' + label);
                e.currentTarget.remove();
            };
        }

        /* –¢–∞–π–º–µ—Ä/–∏–≥—Ä–∞ */
        function tick(now) { const left = (CONFIG.game.duration - (now - t0)) / 1000; tEl.textContent = Math.max(0, left).toFixed(1); if (left > 0) requestAnimationFrame(tick); else endGame(); }
        function clearField() { document.querySelectorAll('.logo,.super,.big,.tornado,.bomb,.roma,.sheet,.ring,.confetti,.float,.boom,.crit-flash,.crit-burst,.crit-ray,.twist,.vortex').forEach(n => n.remove()); }

        // === START / END + –Ω–∞–¥—ë–∂–Ω–∞—è –∫–Ω–æ–ø–∫–∞ "Graj!" ===

            // –∑–∞–ø—É—Å–∫ –∏–≥—Ä—ã
            function startGame() {
                try { navigator.vibrate?.(40); } catch { }

                // –ø—Ä—è—á–µ–º —Å—Ç–∞—Ä—Ç–æ–≤—ã–π –æ–≤–µ—Ä–ª–µ–π –∏ –≤—ã–∫–ª—é—á–∞–µ–º –µ–≥–æ –∫–ª–∏–∫–∏
                startOv.style.display = 'none';
                startOv.style.pointerEvents = 'none';

                // —Å–±—Ä–æ—Å—ã
                running = false; if (spawnTimer) clearInterval(spawnTimer);
                clearField(); discount = 0; superCount = 0; bigCount = 0; romaCount = 0; exitSlowmo(); update();

                // –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞
                tickNo = 0; planSpecials();

                // –∑–∞–ø—É—Å–∫ —Ü–∏–∫–ª–∞ —Å–ø–∞–≤–Ω–∞ –∏ —Ä–µ–Ω–¥–µ—Ä–∞
                running = true; t0 = performance.now();
                spawnTimer = setInterval(spawn, CONFIG.game.spawnInterval);

                if (CONFIG.sounds.enabled && bgMusic) {
                    try { bgMusic.currentTime = 0; bgMusic.play(); } catch { }
                }

                requestAnimationFrame(tick);
                console.log('Gra startuje!');
            }

 
            // –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∏–≥—Ä—ã
            function endGame() {
                running = false; clearInterval(spawnTimer);

                const final = Math.round(discount);
                const s = document.createElement('div'); s.className = 'sheet';
                const currentLB = loadScores();
                const app = document.querySelector('.app');
                app.classList.add('end-wow');

                setTimeout(() => app.classList.remove('end-wow'), 900);

                totalGames += 1;
                localStorage.setItem(LS_KEYS.total, String(totalGames));
                renderTotalGames();

                s.innerHTML = `
    <div style="text-align:center">
      <h2>Koniec!</h2>
      <p>Tw√≥j rabat: <b id="rabatVal">${zl(final)}</b></p>

      <p style="opacity:.9;margin-top:12px">Zr√≥b zrzut ekranu i <b>wy≈õlij nam w wiadomo≈õci</b>.</p>

      <div style="margin:12px 0 6px">
        <input id="lbName" type="text" maxlength="16" placeholder="Twoje imiƒô"
               style="width:220px; padding:10px 12px; border-radius:10px; border:1px solid #333; background:#0f0f0f; color:#fff; font-weight:700"/>
        <button class="btn" id="saveScore" style="margin-left:8px">Zapisz</button>
        <p style="opacity:.9;margin-top:12px">Tutaj mo≈ºesz zapisywaƒá i ≈õledziƒá swoje wyniki w grze.</p>
      </div>

      <div id="lbBox">${renderLeaderboardHTML(currentLB)}</div>

      <br>
      <button class="btn" id="again">Jeszcze raz</button>
    </div>`;

    // –ø–æ—Å–ª–µ –≤—Å—Ç–∞–≤–∫–∏ s.innerHTML:
                s.querySelector('#rabatVal')?.classList.add('rabat-glow-final');

                document.body.appendChild(s);

                s.querySelector('#saveScore').onclick = () => {
                    const name = s.querySelector('#lbName').value.trim() || 'Go≈õƒá';
                    const top = saveScore(name, final);
                    s.querySelector('#lbBox').innerHTML = renderLeaderboardHTML(top);
                };

                s.querySelector('#again').onclick = () => {
                    s.remove();
                    // –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ä—Ç–æ–≤—ã–π —ç–∫—Ä–∞–Ω –∏ —Å–Ω–æ–≤–∞ –º–æ–Ω—Ç–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É
                    startOv.style.display = 'flex';
                    startOv.style.pointerEvents = 'auto';
                    setupStartButton();
                };
            }


            // --- –Ω–∞–¥—ë–∂–Ω–∞—è –ø—Ä–∏–≤—è–∑–∫–∞ –∫–Ω–æ–ø–∫–∏ "Graj!" ---
            function setupStartButton() {
                const oldBtn = document.getElementById('start');
                if (!oldBtn) return;

                // —Å–Ω—è—Ç—å –≤–æ–∑–º–æ–∂–Ω—ã–µ —Å—Ç–∞—Ä—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ ‚Äî –∫–ª–æ–Ω–∏—Ä—É–µ–º
                const newBtn = oldBtn.cloneNode(true);
                oldBtn.replaceWith(newBtn);

                let lock = false; // –∑–∞—â–∏—Ç–∞ –æ—Ç –¥–≤–æ–π–Ω–æ–≥–æ —Ç–∞–ø–∞/–∫–ª–∏–∫–∞
                newBtn.disabled = false;

                newBtn.addEventListener('pointerdown', (e) => {
                    e.preventDefault();
                    if (lock || newBtn.disabled) return;

                    lock = true;
                    newBtn.disabled = true;

                    // –Ω–µ–±–æ–ª—å—à–æ–π –∞–Ω—Ç–∏-–¥–∞–±–ª—Ç–∞–ø –±—É—Ñ–µ—Ä
                    setTimeout(() => { lock = false; newBtn.disabled = false; }, 600);

                    startGame();
                }, { passive: false });
            }

            // –ø–µ—Ä–≤–∏—á–Ω—ã–π –º–æ–Ω—Ç–∞–∂ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', setupStartButton);
            } else {
                setupStartButton();
            }

    </script>
</body>

</html>